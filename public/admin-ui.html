<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Heady Admin Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .glass-effect {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .neon-glow {
            box-shadow: 0 0 20px rgba(102, 126, 234, 0.5);
        }
        .pulse-animation {
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.7; }
            100% { opacity: 1; }
        }
        .status-online { color: #10b981; }
        .status-offline { color: #ef4444; }
        .status-warning { color: #f59e0b; }
    </style>
</head>
<body class="gradient-bg min-h-screen text-white">
    <!-- Header -->
    <header class="glass-effect p-4 border-b border-white/20">
        <div class="container mx-auto flex justify-between items-center">
            <div class="flex items-center space-x-4">
                <i class="fas fa-brain text-3xl text-purple-300"></i>
                <h1 class="text-2xl font-bold">Heady Admin Dashboard</h1>
            </div>
            <div class="flex items-center space-x-6">
                <div class="flex items-center space-x-2">
                    <div class="w-3 h-3 bg-green-500 rounded-full pulse-animation"></div>
                    <span class="text-sm">System Online</span>
                </div>
                <button type="button" onclick="refreshAll()" class="px-4 py-2 bg-purple-600 hover:bg-purple-700 rounded-lg transition">
                    <i class="fas fa-sync-alt mr-2"></i>Refresh
                </button>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto p-6">
        <!-- System Overview Cards -->
        <section class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
            <div class="glass-effect rounded-xl p-6 neon-glow">
                <div class="flex items-center justify-between mb-4">
                    <i class="fas fa-heartbeat text-2xl text-green-400"></i>
                    <span class="text-xs bg-green-500/20 px-2 py-1 rounded">LIVE</span>
                </div>
                <h3 class="text-lg font-semibold mb-2">System Health</h3>
                <p class="text-3xl font-bold" id="system-status">OPTIMAL</p>
                <p class="text-sm opacity-75" id="uptime">Loading...</p>
            </div>

            <div class="glass-effect rounded-xl p-6 neon-glow">
                <div class="flex items-center justify-between mb-4">
                    <i class="fas fa-robot text-2xl text-blue-400"></i>
                    <span class="text-xs bg-blue-500/20 px-2 py-1 rounded">AI</span>
                </div>
                <h3 class="text-lg font-semibold mb-2">Active Nodes</h3>
                <p class="text-3xl font-bold" id="active-nodes">0</p>
                <p class="text-sm opacity-75" id="total-nodes">Total: 0</p>
            </div>

            <div class="glass-effect rounded-xl p-6 neon-glow">
                <div class="flex items-center justify-between mb-4">
                    <i class="fas fa-tasks text-2xl text-purple-400"></i>
                    <span class="text-xs bg-purple-500/20 px-2 py-1 rounded">TASKS</span>
                </div>
                <h3 class="text-lg font-semibold mb-2">Processing</h3>
                <p class="text-3xl font-bold" id="active-tasks">0</p>
                <p class="text-sm opacity-75" id="queued-tasks">Queued: 0</p>
            </div>

            <div class="glass-effect rounded-xl p-6 neon-glow">
                <div class="flex items-center justify-between mb-4">
                    <i class="fas fa-memory text-2xl text-yellow-400"></i>
                    <span class="text-xs bg-yellow-500/20 px-2 py-1 rounded">MEMORY</span>
                </div>
                <h3 class="text-lg font-semibold mb-2">Memories</h3>
                <p class="text-3xl font-bold" id="memory-count">0</p>
                <p class="text-sm opacity-75" id="memory-categories">Categories: 0</p>
            </div>
        </section>

        <!-- Control Panels -->
        <section class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
            <!-- Socratic Control -->
            <div class="glass-effect rounded-xl p-6">
                <h2 class="text-xl font-bold mb-4 flex items-center">
                    <i class="fas fa-question-circle mr-3 text-purple-400"></i>
                    Socratic Questioning
                </h2>
                <div class="space-y-4">
                    <div class="flex items-center justify-between">
                        <span>Status</span>
                        <span id="socratic-status" class="status-online">
                            <i class="fas fa-circle text-xs mr-2"></i>Active
                        </span>
                    </div>
                    <div class="flex items-center justify-between">
                        <span>Questions Asked</span>
                        <span id="socratic-questions">0</span>
                    </div>
                    <div class="mt-4">
                        <textarea id="socratic-input" 
                                  class="w-full p-3 bg-white/10 rounded-lg border border-white/20 text-white placeholder-white/50"
                                  rows="3" 
                                  placeholder="Ask SOCRATES a question..."></textarea>
                        <button type="button" onclick="askSocratic()" 
                                class="mt-2 w-full px-4 py-2 bg-purple-600 hover:bg-purple-700 rounded-lg transition">
                            <i class="fas fa-comments mr-2"></i>Ask SOCRATES
                        </button>
                    </div>
                    <div id="socratic-response" class="hidden p-4 bg-white/10 rounded-lg border border-white/20">
                        <!-- Response will appear here -->
                    </div>
                </div>
            </div>

            <!-- Multi-LLM Control -->
            <div class="glass-effect rounded-xl p-6">
                <h2 class="text-xl font-bold mb-4 flex items-center">
                    <i class="fas fa-orchestration mr-3 text-blue-400"></i>
                    Multi-LLM Orchestration
                </h2>
                <div class="space-y-4">
                    <div class="flex items-center justify-between">
                        <span>Status</span>
                        <span id="conductor-status" class="status-online">
                            <i class="fas fa-circle text-xs mr-2"></i>Active
                        </span>
                    </div>
                    <div class="flex items-center justify-between">
                        <span>Available Providers</span>
                        <span id="provider-count">0</span>
                    </div>
                    <div class="flex items-center justify-between">
                        <span>Total Requests</span>
                        <span id="total-requests">0</span>
                    </div>
                    <div class="mt-4">
                        <select id="llm-strategy" class="w-full p-3 bg-white/10 rounded-lg border border-white/20 text-white">
                            <option value="consensus">Consensus Building</option>
                            <option value="best-fit">Best Fit Selection</option>
                            <option value="parallel">Parallel Processing</option>
                            <option value="fallback">Fallback Chain</option>
                        </select>
                        <textarea id="llm-input" 
                                  class="w-full p-3 bg-white/10 rounded-lg border border-white/20 text-white placeholder-white/50 mt-2"
                                  rows="3" 
                                  placeholder="Task for multi-LLM processing..."></textarea>
                        <button type="button" onclick="orchestrateLLM()" 
                                class="mt-2 w-full px-4 py-2 bg-blue-600 hover:bg-blue-700 rounded-lg transition">
                            <i class="fas fa-robot mr-2"></i>Orchestrate LLMs
                        </button>
                    </div>
                    <div id="llm-response" class="hidden p-4 bg-white/10 rounded-lg border border-white/20">
                        <!-- Response will appear here -->
                    </div>
                </div>
            </div>
        </section>

        <!-- All-Nodes Control -->
        <section class="glass-effect rounded-xl p-6 mb-8">
            <h2 class="text-xl font-bold mb-4 flex items-center">
                <i class="fas fa-network-wired mr-3 text-green-400"></i>
                All-Node Collaboration
            </h2>
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <div class="space-y-4">
                    <div class="flex items-center justify-between">
                        <span>Total Executions</span>
                        <span id="total-executions">0</span>
                    </div>
                    <div class="flex items-center justify-between">
                        <span>Collaboration Score</span>
                        <span id="collaboration-score">0%</span>
                    </div>
                    <div class="flex items-center justify-between">
                        <span>Active Nodes</span>
                        <span id="active-nodes-count">0</span>
                    </div>
                </div>
                <div class="space-y-4">
                    <textarea id="all-nodes-input" 
                              class="w-full p-3 bg-white/10 rounded-lg border border-white/20 text-white placeholder-white/50"
                              rows="3" 
                              placeholder="Request for all-node collaboration..."></textarea>
                    <button type="button" onclick="processAllNodes()" 
                            class="w-full px-4 py-2 bg-green-600 hover:bg-green-700 rounded-lg transition">
                        <i class="fas fa-users mr-2"></i>Process with All Nodes
                    </button>
                    <div id="all-nodes-response" class="hidden p-4 bg-white/10 rounded-lg border border-white/20">
                        <!-- Response will appear here -->
                    </div>
                </div>
            </div>
        </section>

        <!-- Performance Charts -->
        <section class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <div class="glass-effect rounded-xl p-6">
                <h2 class="text-xl font-bold mb-4">System Performance</h2>
                <canvas id="performance-chart"></canvas>
            </div>
            <div class="glass-effect rounded-xl p-6">
                <h2 class="text-xl font-bold mb-4">Node Activity</h2>
                <canvas id="node-chart"></canvas>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer class="glass-effect p-4 border-t border-white/20 mt-8">
        <div class="container mx-auto text-center">
            <p class="text-sm opacity-75">Heady Admin Dashboard - Production System</p>
        </div>
    </footer>

    <script>
        // API Base URL - Production domain
        const API_BASE = 'https://headyme.com/api';
        
        // Initialize charts
        let performanceChart, nodeChart;

        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', function() {
            initializeCharts();
            refreshAll();
            setInterval(refreshHealth, 5000); // Refresh every 5 seconds
        });

        // Initialize performance charts
        function initializeCharts() {
            // Performance Chart
            const perfCtx = document.getElementById('performance-chart').getContext('2d');
            performanceChart = new Chart(perfCtx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'CPU Usage',
                        data: [],
                        borderColor: 'rgb(75, 192, 192)',
                        backgroundColor: 'rgba(75, 192, 192, 0.2)',
                        tension: 0.1
                    }, {
                        label: 'Memory Usage',
                        data: [],
                        borderColor: 'rgb(255, 99, 132)',
                        backgroundColor: 'rgba(255, 99, 132, 0.2)',
                        tension: 0.1
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100,
                            ticks: { color: 'white' },
                            grid: { color: 'rgba(255, 255, 255, 0.1)' }
                        },
                        x: {
                            ticks: { color: 'white' },
                            grid: { color: 'rgba(255, 255, 255, 0.1)' }
                        }
                    },
                    plugins: {
                        legend: { labels: { color: 'white' } }
                    }
                }
            });

            // Node Activity Chart
            const nodeCtx = document.getElementById('node-chart').getContext('2d');
            nodeChart = new Chart(nodeCtx, {
                type: 'doughnut',
                data: {
                    labels: ['SOCRATES', 'CONDUCTOR', 'Other Nodes'],
                    datasets: [{
                        data: [1, 1, 0],
                        backgroundColor: [
                            'rgba(147, 51, 234, 0.8)',
                            'rgba(59, 130, 246, 0.8)',
                            'rgba(34, 197, 94, 0.8)'
                        ],
                        borderColor: [
                            'rgba(147, 51, 234, 1)',
                            'rgba(59, 130, 246, 1)',
                            'rgba(34, 197, 94, 1)'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: { labels: { color: 'white' } }
                    }
                }
            });
        }

        // Refresh all dashboard data
        async function refreshAll() {
            await Promise.all([
                refreshHealth(),
                refreshSocratic(),
                refreshConductor(),
                refreshAllNodes()
            ]);
        }

        // Refresh system health
        async function refreshHealth() {
            try {
                const response = await fetch(`${API_BASE}/health`);
                const data = await response.json();
                
                document.getElementById('system-status').textContent = data.status || 'ERROR';
                document.getElementById('uptime').textContent = `Uptime: ${Math.floor(data.uptime)}s`;
                document.getElementById('active-tasks').textContent = data.performance.activeTasks;
                document.getElementById('queued-tasks').textContent = data.performance.queuedTasks;
                document.getElementById('memory-count').textContent = data.headyMemory.memory.total_memories;
                document.getElementById('memory-categories').textContent = Object.keys(data.headyMemory.memory.by_category).length;
                
                // Update performance chart
                updatePerformanceChart(data);
            } catch (error) {
                console.error('Health refresh failed:', error);
                document.getElementById('system-status').textContent = 'ERROR';
            }
        }

        // Refresh Socratic status
        async function refreshSocratic() {
            try {
                const response = await fetch(`${API_BASE}/socratic/status`);
                const data = await response.json();
                
                document.getElementById('socratic-questions').textContent = data.questionsAsked || 0;
                document.getElementById('socratic-status').innerHTML = data.active ? 
                    '<i class="fas fa-circle text-xs mr-2 status-online"></i>Active' :
                    '<i class="fas fa-circle text-xs mr-2 status-offline"></i>Inactive';
            } catch (error) {
                console.error('Socratic refresh failed:', error);
            }
        }

        // Refresh Conductor status
        async function refreshConductor() {
            try {
                const response = await fetch(`${API_BASE}/conductor/status`);
                const data = await response.json();
                
                document.getElementById('provider-count').textContent = data.providers.length;
                document.getElementById('total-requests').textContent = data.performance.totalRequests;
                document.getElementById('conductor-status').innerHTML = data.active ? 
                    '<i class="fas fa-circle text-xs mr-2 status-online"></i>Active' :
                    '<i class="fas fa-circle text-xs mr-2 status-offline"></i>Inactive';
            } catch (error) {
                console.error('Conductor refresh failed:', error);
            }
        }

        // Refresh All-Nodes status
        async function refreshAllNodes() {
            try {
                const response = await fetch(`${API_BASE}/all-nodes/status`);
                const data = await response.json();
                
                document.getElementById('active-nodes').textContent = data.activeNodes;
                document.getElementById('total-nodes').textContent = `Total: ${data.totalNodes}`;
                document.getElementById('total-executions').textContent = data.collaborationMetrics.totalExecutions;
                document.getElementById('collaboration-score').textContent = `${Math.round(data.collaborationMetrics.averageCollaborationScore)}%`;
                document.getElementById('active-nodes-count').textContent = data.activeNodes;
                
                // Update node chart
                updateNodeChart(data);
            } catch (error) {
                console.error('All-Nodes refresh failed:', error);
            }
        }

        // Ask Socratic question
        async function askSocratic() {
            const input = document.getElementById('socratic-input').value.trim();
            if (!input) return;
            
            const responseDiv = document.getElementById('socratic-response');
            responseDiv.classList.remove('hidden');
            responseDiv.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Thinking...';
            
            try {
                const response = await fetch(`${API_BASE}/socratic/question`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ request: input })
                });
                
                const data = await response.json();
                
                if (data.type === 'clarification_needed') {
                    responseDiv.innerHTML = `
                        <div class="mb-2"><strong>Questions for you:</strong></div>
                        <ul class="list-disc list-inside space-y-1">
                            ${data.questions.map(q => `<li>${q}</li>`).join('')}
                        </ul>
                        <div class="mt-3 text-sm opacity-75">Please provide answers to continue...</div>
                    `;
                } else {
                    responseDiv.innerHTML = `
                        <div class="mb-2"><strong>Intent Analysis:</strong></div>
                        <div class="text-sm">${JSON.stringify(data.intent, null, 2)}</div>
                    `;
                }
                
                await refreshSocratic();
            } catch (error) {
                responseDiv.innerHTML = `<div class="text-red-400">Error: ${error.message}</div>`;
            }
        }

        // Orchestrate Multi-LLM
        async function orchestrateLLM() {
            const task = document.getElementById('llm-input').value.trim();
            const strategy = document.getElementById('llm-strategy').value;
            if (!task) return;
            
            const responseDiv = document.getElementById('llm-response');
            responseDiv.classList.remove('hidden');
            responseDiv.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Orchestrating...';
            
            try {
                const response = await fetch(`${API_BASE}/conductor/orchestrate`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        task: task,
                        strategy: strategy,
                        providers: ['auto']
                    })
                });
                
                const data = await response.json();
                
                responseDiv.innerHTML = `
                    <div class="mb-2"><strong>Strategy: ${data.strategy}</strong></div>
                    <div class="mb-2"><strong>Providers Used:</strong> ${data.providers.join(', ')}</div>
                    <div class="mb-2"><strong>Response:</strong></div>
                    <div class="text-sm">${data.response || data.error || 'Processing complete'}</div>
                `;
                
                await refreshConductor();
            } catch (error) {
                responseDiv.innerHTML = `<div class="text-red-400">Error: ${error.message}</div>`;
            }
        }

        // Process with All Nodes
        async function processAllNodes() {
            const input = document.getElementById('all-nodes-input').value.trim();
            if (!input) return;
            
            const responseDiv = document.getElementById('all-nodes-response');
            responseDiv.classList.remove('hidden');
            responseDiv.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Collaborating...';
            
            try {
                const response = await fetch(`${API_BASE}/all-nodes/process`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ request: input })
                });
                
                const data = await response.json();
                
                responseDiv.innerHTML = `
                    <div class="mb-2"><strong>Stage: ${data.stage}</strong></div>
                    <div class="mb-2"><strong>Nodes Invoked:</strong> ${data.node_results?.invoked?.join(', ') || 'Processing...'}</div>
                    <div class="mb-2"><strong>Collaboration Score:</strong> ${data.collaboration_score || 0}%</div>
                    <div class="mb-2"><strong>Execution Time:</strong> ${data.execution_time || 0}ms</div>
                    <div class="text-sm">${data.synthesis?.text || data.error || 'Processing complete'}</div>
                `;
                
                await refreshAllNodes();
            } catch (error) {
                responseDiv.innerHTML = `<div class="text-red-400">Error: ${error.message}</div>`;
            }
        }

        // Update performance chart
        function updatePerformanceChart(data) {
            const now = new Date().toLocaleTimeString();
            
            if (performanceChart.data.labels.length > 10) {
                performanceChart.data.labels.shift();
                performanceChart.data.datasets[0].data.shift();
                performanceChart.data.datasets[1].data.shift();
            }
            
            performanceChart.data.labels.push(now);
            performanceChart.data.datasets[0].data.push(0); // CPU placeholder
            performanceChart.data.datasets[1].data.push(
                Math.round((data.memory.heapUsed / data.memory.heapTotal) * 100)
            );
            performanceChart.update();
        }

        // Update node chart
        function updateNodeChart(data) {
            nodeChart.data.datasets[0].data = [
                1, // SOCRATES
                1, // CONDUCTOR
                Math.max(0, data.activeNodes - 2) // Other nodes
            ];
            nodeChart.update();
        }

        // Refresh button handler
        function refreshAll() {
            refreshAll();
        }
    </script>
</body>
</html>
