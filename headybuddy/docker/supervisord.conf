# ╔═══════════════════════════════════════════════════════════════╗
# ║  HEADY SYSTEMS — Supervisor Config for Desktop Container       ║
# ╚═══════════════════════════════════════════════════════════════╝

[supervisord]
nodaemon=true
user=root
logfile=/var/log/supervisor/supervisord.log
pidfile=/var/run/supervisord.pid
childlogdir=/var/log/supervisor

# ─── VNC Server ───────────────────────────────────────────────────
[program:vnc]
command=/usr/local/bin/startup.sh
autorestart=true
priority=10
stdout_logfile=/var/log/supervisor/vnc.log
stderr_logfile=/var/log/supervisor/vnc-err.log

# ─── noVNC (browser access) ──────────────────────────────────────
[program:novnc]
command=websockify --web=/usr/share/novnc/ %(ENV_NOVNC_PORT)s localhost:%(ENV_VNC_PORT)s
autorestart=true
priority=20
stdout_logfile=/var/log/supervisor/novnc.log
stderr_logfile=/var/log/supervisor/novnc-err.log

# ─── Heady Manager API ───────────────────────────────────────────
[program:heady-manager]
command=node /opt/heady/heady-manager.js
directory=/opt/heady
user=heady
environment=NODE_ENV="production",PORT="3300",HEADY_TARGET="DockerDesktop"
autorestart=true
priority=30
stdout_logfile=/var/log/supervisor/heady-manager.log
stderr_logfile=/var/log/supervisor/heady-manager-err.log

# ─── HeadyBuddy Widget Server ────────────────────────────────────
[program:headybuddy-widget]
command=npx serve -s /opt/heady/headybuddy/dist -l 3400
directory=/opt/heady/headybuddy
user=heady
autorestart=true
priority=40
stdout_logfile=/var/log/supervisor/headybuddy.log
stderr_logfile=/var/log/supervisor/headybuddy-err.log
